plugins {
    id 'java'
}

version '1.0'

repositories {
    mavenCentral()
}

jar {
    archiveName("zdarova.jar")
    manifest {
        attributes(
                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Main-Class': 'Main'
        )
    }
}

task toDocker {
    doLast {
        def stdout = new ByteArrayOutputStream()

        println("Moving jar-file...")
        ant.move file: "${buildDir}/libs/zdarova.jar", todir: "${projectDir}/testDir"

        println("\nCreating Docker container...")
        exec {
            workingDir "${projectDir}/testDir"
            commandLine 'docker', 'build', '-t', 'hello', '.'
        }

        println("\nLaunching Docker container...")
        exec {
            workingDir "${projectDir}/testDir"
            commandLine 'docker', 'run', 'hello'
            standardOutput = stdout
        }
        println "\nOutput from Docker container:\n$stdout"
    }
}

build.finalizedBy(toDocker)